<Window x:Class="FocusDock.App.PlannerWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Planner" 
        Width="1600" Height="900"
        Background="#0F0F10" 
        Foreground="#E8EAED"
        Loaded="Window_Loaded">
    <Window.Resources>
        <SolidColorBrush x:Key="AccentBrush" Color="#7B5FFF"/>
        <SolidColorBrush x:Key="AccentHoverBrush" Color="#9176FF"/>
        <SolidColorBrush x:Key="DarkBg1" Color="#0F0F10"/>
        <SolidColorBrush x:Key="DarkBg2" Color="#1C1C1F"/>
        <SolidColorBrush x:Key="DarkBg3" Color="#252629"/>
        <SolidColorBrush x:Key="DarkBg4" Color="#2D2F33"/>
        <SolidColorBrush x:Key="StrokeBrush" Color="#3F4550"/>
        <SolidColorBrush x:Key="TextPrimary" Color="#E8EAED"/>
        <SolidColorBrush x:Key="TextSecondary" Color="#AAB2BE"/>
        <SolidColorBrush x:Key="SuccessBrush" Color="#4CAF50"/>
        <SolidColorBrush x:Key="WarningBrush" Color="#FF9800"/>
        <SolidColorBrush x:Key="DangerBrush" Color="#F44336"/>
        <SolidColorBrush x:Key="InfoBrush" Color="#2196F3"/>
        <SolidColorBrush x:Key="ErrorBrush" Color="#F44336"/>
        
        <!-- Icon Button Style -->
        <Style x:Key="IconButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="{StaticResource DarkBg2}"/>
            <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
            <Setter Property="BorderBrush" Value="{StaticResource StrokeBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="8"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="6"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="{StaticResource DarkBg3}"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="Background" Value="{StaticResource DarkBg4}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Planner ComboBox Style -->
            <ControlTemplate x:Key="PlannerComboBoxTemplate" TargetType="ComboBox">
                <Grid>
                    <Border x:Name="Border"
                            Background="{TemplateBinding Background}"
                            BorderBrush="{TemplateBinding BorderBrush}"
                            BorderThickness="{TemplateBinding BorderThickness}"
                            CornerRadius="8"
                            SnapsToDevicePixels="True"/>
                    <Grid Margin="0">
                        <ContentPresenter x:Name="ContentSite"
                                          Margin="12,4,36,4"
                                          VerticalAlignment="Center"
                                          HorizontalAlignment="Left"
                                          Content="{TemplateBinding SelectionBoxItem}"
                                          ContentTemplate="{TemplateBinding SelectionBoxItemTemplate}"
                                          ContentTemplateSelector="{TemplateBinding ItemTemplateSelector}"
                                          SnapsToDevicePixels="True"/>
                        <Path x:Name="Arrow"
                              HorizontalAlignment="Right"
                              VerticalAlignment="Center"
                              Margin="0,0,12,0"
                              Fill="{StaticResource TextSecondary}"
                              Stretch="Uniform"
                              Width="12"
                              Height="6"
                              Data="M 0 0 L 1 0 0.5 0.7 Z"/>
                    </Grid>
                    <Popup x:Name="Popup"
                           Placement="Bottom"
                           AllowsTransparency="True"
                           Focusable="False"
                           IsOpen="{TemplateBinding IsDropDownOpen}"
                           PopupAnimation="Slide">
                        <Border x:Name="PopupBorder"
                                Background="{StaticResource DarkBg3}"
                                BorderBrush="{StaticResource StrokeBrush}"
                                BorderThickness="1"
                                CornerRadius="8"
                                Padding="4"
                                SnapsToDevicePixels="True">
                            <ScrollViewer Margin="0"
                                          SnapsToDevicePixels="True">
                                <StackPanel IsItemsHost="True"
                                            KeyboardNavigation.DirectionalNavigation="Contained"/>
                            </ScrollViewer>
                        </Border>
                    </Popup>
                </Grid>
                <ControlTemplate.Triggers>
                    <Trigger Property="IsMouseOver" Value="True">
                        <Setter TargetName="Border" Property="Background" Value="{StaticResource DarkBg4}"/>
                    </Trigger>
                    <Trigger Property="IsKeyboardFocusWithin" Value="True">
                        <Setter TargetName="Border" Property="BorderBrush" Value="{StaticResource AccentBrush}"/>
                    </Trigger>
                    <Trigger Property="IsDropDownOpen" Value="True">
                        <Setter TargetName="Border" Property="BorderBrush" Value="{StaticResource AccentBrush}"/>
                        <Setter TargetName="Arrow" Property="Fill" Value="{StaticResource AccentBrush}"/>
                    </Trigger>
                    <Trigger Property="HasItems" Value="False">
                        <Setter TargetName="PopupBorder" Property="MinHeight" Value="32"/>
                    </Trigger>
                </ControlTemplate.Triggers>
            </ControlTemplate>

            <ControlTemplate x:Key="PlannerComboBoxEditableTemplate" TargetType="ComboBox">
                <Grid>
                    <Border x:Name="Border"
                            Background="{TemplateBinding Background}"
                            BorderBrush="{TemplateBinding BorderBrush}"
                            BorderThickness="{TemplateBinding BorderThickness}"
                            CornerRadius="8"
                            SnapsToDevicePixels="True"/>
                    <Grid>
                        <TextBox x:Name="PART_EditableTextBox"
                                 Background="Transparent"
                                 BorderThickness="0"
                                 Foreground="{TemplateBinding Foreground}"
                                 FontSize="{TemplateBinding FontSize}"
                                 Margin="12,4,36,4"
                                 HorizontalAlignment="Stretch"
                                 VerticalAlignment="Center"
                                 Focusable="True"
                                 Text="{TemplateBinding Text}"
                                 IsReadOnly="{TemplateBinding IsReadOnly}"/>
                        <ContentPresenter x:Name="ContentSite"
                                          Margin="12,4,36,4"
                                          VerticalAlignment="Center"
                                          HorizontalAlignment="Left"
                                          Content="{TemplateBinding SelectionBoxItem}"
                                          ContentTemplate="{TemplateBinding SelectionBoxItemTemplate}"
                                          ContentTemplateSelector="{TemplateBinding ItemTemplateSelector}"
                                          Visibility="Hidden"/>
                        <Path x:Name="Arrow"
                              HorizontalAlignment="Right"
                              VerticalAlignment="Center"
                              Margin="0,0,12,0"
                              Fill="{StaticResource TextSecondary}"
                              Stretch="Uniform"
                              Width="12"
                              Height="6"
                              Data="M 0 0 L 1 0 0.5 0.7 Z"/>
                    </Grid>
                    <Popup x:Name="Popup"
                           Placement="Bottom"
                           AllowsTransparency="True"
                           Focusable="False"
                           IsOpen="{TemplateBinding IsDropDownOpen}"
                           PopupAnimation="Slide">
                        <Border x:Name="PopupBorder"
                                Background="{StaticResource DarkBg3}"
                                BorderBrush="{StaticResource StrokeBrush}"
                                BorderThickness="1"
                                CornerRadius="8"
                                Padding="4"
                                SnapsToDevicePixels="True">
                            <ScrollViewer Margin="0"
                                          SnapsToDevicePixels="True">
                                <StackPanel IsItemsHost="True"
                                            KeyboardNavigation.DirectionalNavigation="Contained"/>
                            </ScrollViewer>
                        </Border>
                    </Popup>
                </Grid>
                <ControlTemplate.Triggers>
                    <Trigger Property="IsMouseOver" Value="True">
                        <Setter TargetName="Border" Property="Background" Value="{StaticResource DarkBg4}"/>
                    </Trigger>
                    <Trigger Property="IsKeyboardFocusWithin" Value="True">
                        <Setter TargetName="Border" Property="BorderBrush" Value="{StaticResource AccentBrush}"/>
                    </Trigger>
                    <Trigger Property="IsDropDownOpen" Value="True">
                        <Setter TargetName="Border" Property="BorderBrush" Value="{StaticResource AccentBrush}"/>
                        <Setter TargetName="Arrow" Property="Fill" Value="{StaticResource AccentBrush}"/>
                    </Trigger>
                    <Trigger Property="IsEditable" Value="False">
                        <Setter TargetName="PART_EditableTextBox" Property="Visibility" Value="Hidden"/>
                    </Trigger>
                </ControlTemplate.Triggers>
            </ControlTemplate>

            <Style x:Key="PlannerComboBoxStyle" TargetType="ComboBox">
                <Setter Property="Background" Value="{StaticResource DarkBg3}"/>
                <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
                <Setter Property="BorderBrush" Value="{StaticResource StrokeBrush}"/>
                <Setter Property="BorderThickness" Value="1"/>
                <Setter Property="Padding" Value="12,8"/>
                <Setter Property="Margin" Value="0,0,8,0"/>
                <Setter Property="FontSize" Value="13"/>
                <Setter Property="MinWidth" Value="160"/>
                <Setter Property="MinHeight" Value="36"/>
                <Setter Property="Cursor" Value="Hand"/>
                <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                <Setter Property="VerticalContentAlignment" Value="Center"/>
                <Setter Property="SnapsToDevicePixels" Value="True"/>
                <Setter Property="Template" Value="{StaticResource PlannerComboBoxTemplate}"/>
                <Setter Property="ItemContainerStyle">
                    <Setter.Value>
                        <Style TargetType="ComboBoxItem">
                            <Setter Property="Padding" Value="10,6"/>
                            <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
                            <Setter Property="Background" Value="{StaticResource DarkBg3}"/>
                            <Setter Property="HorizontalContentAlignment" Value="Left"/>
                            <Setter Property="VerticalContentAlignment" Value="Center"/>
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="ComboBoxItem">
                                        <Border x:Name="Bd"
                                                Background="{TemplateBinding Background}"
                                                CornerRadius="6"
                                                Padding="{TemplateBinding Padding}">
                                            <ContentPresenter HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                                              VerticalAlignment="{TemplateBinding VerticalContentAlignment}"/>
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter TargetName="Bd" Property="Background" Value="{StaticResource DarkBg4}"/>
                                            </Trigger>
                                            <Trigger Property="IsSelected" Value="True">
                                                <Setter TargetName="Bd" Property="Background" Value="{StaticResource AccentBrush}"/>
                                                <Setter Property="Foreground" Value="White"/>
                                            </Trigger>
                                            <Trigger Property="IsEnabled" Value="False">
                                                <Setter TargetName="Bd" Property="Opacity" Value="0.6"/>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </Setter.Value>
                </Setter>
                <Style.Triggers>
                    <Trigger Property="IsEditable" Value="True">
                        <Setter Property="Template" Value="{StaticResource PlannerComboBoxEditableTemplate}"/>
                    </Trigger>
                    <Trigger Property="IsEnabled" Value="False">
                        <Setter Property="Opacity" Value="0.6"/>
                    </Trigger>
                </Style.Triggers>
            </Style>

            <Style x:Key="QuickActionButtonStyle" TargetType="Button">
                <Setter Property="Background" Value="{StaticResource DarkBg3}"/>
                <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
                <Setter Property="BorderBrush" Value="{StaticResource StrokeBrush}"/>
                <Setter Property="BorderThickness" Value="1"/>
                <Setter Property="Padding" Value="12,8"/>
                <Setter Property="Margin" Value="0,0,8,0"/>
                <Setter Property="FontSize" Value="13"/>
                <Setter Property="Cursor" Value="Hand"/>
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="Button">
                            <Border Background="{TemplateBinding Background}"
                                    BorderBrush="{TemplateBinding BorderBrush}"
                                    BorderThickness="{TemplateBinding BorderThickness}"
                                    CornerRadius="8"
                                    Padding="{TemplateBinding Padding}">
                                <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Border>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="{StaticResource DarkBg4}"/>
                                </Trigger>
                                <Trigger Property="IsPressed" Value="True">
                                    <Setter Property="Background" Value="{StaticResource DarkBg2}"/>
                                </Trigger>
                                <Trigger Property="IsEnabled" Value="False">
                                    <Setter Property="Opacity" Value="0.6"/>
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>
    </Window.Resources>
    
    <!-- Main Layout -->
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="Auto"/>
            <ColumnDefinition x:Name="RightPanelColumn" Width="450"/>
        </Grid.ColumnDefinitions>
        
        <!-- Main Content -->
        <Border Grid.Column="0" Background="{StaticResource DarkBg1}">
            <Grid Margin="40,30">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                
                <!-- Header -->
                <StackPanel Grid.Row="0" Margin="0,0,0,25">
                    <TextBlock x:Name="TxtViewTitle" Text="My Planner" FontSize="32" FontWeight="Bold" Foreground="{StaticResource TextPrimary}"/>
                    <TextBlock x:Name="TxtViewSubtitle" Text="Organize your tasks" FontSize="14" Foreground="{StaticResource TextSecondary}" Margin="0,8,0,0"/>
                </StackPanel>
                
                <!-- Toolbar -->
                <Grid Grid.Row="1" Margin="0,0,0,20">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <StackPanel Grid.Column="0" Orientation="Horizontal">
                        <ComboBox x:Name="CmbViewSelector" Width="200" Height="38" FontSize="13" Background="{StaticResource DarkBg2}" Foreground="{StaticResource TextPrimary}" BorderBrush="{StaticResource StrokeBrush}" SelectionChanged="OnViewSelectorChanged">
                            <ComboBoxItem Content="☀️ My Day" Tag="myday"/>
                            <ComboBoxItem Content="📅 Today" Tag="today"/>
                            <ComboBoxItem Content="🗓️ Upcoming" Tag="upcoming"/>
                            <ComboBoxItem Content="⚠️ Overdue" Tag="overdue"/>
                            <ComboBoxItem Content="📝 All Tasks" Tag="all"/>
                            <ComboBoxItem Content="🎓 Canvas" Tag="canvas"/>
                            <ComboBoxItem Content="📆 Calendar" Tag="calendar"/>
                            <ComboBoxItem Content="✅ Completed" Tag="completed"/>
                        </ComboBox>
                        <Button x:Name="BtnCategoryFilter" Content="📂 Categories" Margin="10,0,0,0" Click="OnCategoryFilterClick" Background="{StaticResource DarkBg3}" Foreground="{StaticResource TextPrimary}" BorderBrush="{StaticResource StrokeBrush}" BorderThickness="1" Padding="12,8" FontSize="13" Cursor="Hand"/>
                    </StackPanel>
                    
                    <StackPanel Grid.Column="1" Orientation="Horizontal">
                        <Button Content="🔽 Sort" Click="OnSortClick" Margin="0,0,8,0" Background="{StaticResource DarkBg3}" Foreground="{StaticResource TextPrimary}" BorderBrush="{StaticResource StrokeBrush}" BorderThickness="1" Padding="12,8" FontSize="13" Cursor="Hand"/>
                        <Button Content="🔍 Filter" Click="OnFilterClick" Margin="0,0,8,0" Background="{StaticResource DarkBg3}" Foreground="{StaticResource TextPrimary}" BorderBrush="{StaticResource StrokeBrush}" BorderThickness="1" Padding="12,8" FontSize="13" Cursor="Hand"/>
                        <ToggleButton x:Name="BtnTogglePanel" Content="📊 Panel" IsChecked="True" Checked="OnPanelToggle" Unchecked="OnPanelToggle" Background="{StaticResource DarkBg3}" Foreground="{StaticResource TextPrimary}" BorderBrush="{StaticResource StrokeBrush}" BorderThickness="1" Padding="10,8" FontSize="13" Cursor="Hand"/>
                    </StackPanel>
                </Grid>
                
                <!-- Quick Add -->
                <Border Grid.Row="2" Background="{StaticResource DarkBg2}" BorderBrush="{StaticResource AccentBrush}" BorderThickness="2" CornerRadius="8" Padding="15" Margin="0,0,0,20">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <Grid Grid.Row="0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBox x:Name="TxtQuickAdd" Grid.Column="0" Background="{StaticResource DarkBg3}" Foreground="{StaticResource TextPrimary}" BorderBrush="{StaticResource StrokeBrush}" BorderThickness="1" Padding="12,10" FontSize="14" VerticalContentAlignment="Center" KeyDown="OnQuickAddKeyDown"/>
                            <Button Grid.Column="1" Content="➕ Add Task" Background="{StaticResource AccentBrush}" Foreground="White" BorderThickness="0" Padding="20,10" FontSize="14" Cursor="Hand" Margin="10,0,0,0" Click="OnQuickAddSubmit"/>
                        </Grid>
                        <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,10,0,0">
                    <ComboBox x:Name="CmbQuickDueDate"
                          Style="{StaticResource PlannerComboBoxStyle}"
                          MinWidth="170"
                          Margin="0,0,8,0"
                                      SelectedValuePath="Tag"
                                      SelectionChanged="OnQuickDueDateSelectionChanged">
                                <ComboBoxItem x:Name="DueDateTimelineItem" Content="📅 Use timeline selection" Tag="timeline" IsSelected="True"/>
                                <ComboBoxItem Content="📅 No due date" Tag="none"/>
                                <ComboBoxItem Content="📅 Today" Tag="today"/>
                                <ComboBoxItem Content="📅 Tomorrow" Tag="tomorrow"/>
                                <ComboBoxItem Content="📅 In 3 days" Tag="next3"/>
                                <ComboBoxItem Content="📅 Next week" Tag="next7"/>
                                <ComboBoxItem x:Name="DueDateCustomItem" Content="📅 Custom date..." Tag="custom"/>
                            </ComboBox>

                            <ComboBox x:Name="CmbQuickPriority"
                                      Style="{StaticResource PlannerComboBoxStyle}"
                                      Width="150"
                                      Margin="0,0,8,0"
                                      SelectedValuePath="Tag"
                                      SelectedValue="2"
                                      SelectionChanged="OnQuickPrioritySelectionChanged">
                                <ComboBoxItem Content="🚨 High" Tag="1"/>
                                <ComboBoxItem Content="⚖️ Normal" Tag="2" IsSelected="True"/>
                                <ComboBoxItem Content="🌙 Low" Tag="3"/>
                                <ComboBoxItem Content="🧊 Lowest" Tag="4"/>
                            </ComboBox>

                            <ComboBox x:Name="CmbQuickTags"
                                      Style="{StaticResource PlannerComboBoxStyle}"
                                      Width="200"
                                      Margin="0,0,8,0"
                                      IsEditable="True"
                                      IsTextSearchEnabled="True"
                                      StaysOpenOnEdit="True"
                                      SelectionChanged="OnQuickTagSelectionChanged"
                                      PreviewKeyDown="OnQuickTagComboPreviewKeyDown"
                                      GotFocus="OnQuickTagComboGotFocus"
                                      LostFocus="OnQuickTagComboLostFocus"/>

                            <ComboBox x:Name="CmbQuickReminder"
                                      Style="{StaticResource PlannerComboBoxStyle}"
                                      MinWidth="170"
                                      Margin="0,0,8,0"
                                      SelectedValuePath="Tag"
                                      SelectionChanged="OnQuickReminderSelectionChanged">
                                <ComboBoxItem Content="🔕 No reminder" Tag="none" IsSelected="True"/>
                                <ComboBoxItem Content="⏰ Later today (2 hrs)" Tag="laterToday"/>
                                <ComboBoxItem Content="🌅 Tomorrow morning" Tag="tomorrowMorning"/>
                                <ComboBoxItem Content="🗓️ Day before due" Tag="dayBefore"/>
                                <ComboBoxItem x:Name="ReminderCustomItem" Content="📝 Custom reminder..." Tag="custom"/>
                            </ComboBox>

                            <Button Content="🧹 Clear" Style="{StaticResource QuickActionButtonStyle}" Click="OnQuickAddClearClick" ToolTip="Reset quick add selections"/>

                            <StackPanel x:Name="PnlActiveMetadata" Orientation="Horizontal" Margin="6,0,0,0"/>
                        </StackPanel>
                    </Grid>
                </Border>
                
                <!-- Content -->
                <Border Grid.Row="3" Background="{StaticResource DarkBg2}" CornerRadius="8" BorderBrush="{StaticResource StrokeBrush}" BorderThickness="1">
                    <Grid>
                        <ScrollViewer VerticalScrollBarVisibility="Auto">
                            <StackPanel x:Name="TasksList" Margin="20"/>
                        </ScrollViewer>
                        <TextBlock x:Name="TxtEmptyState" Text="✨ All clear! Add a task to get started." FontSize="16" Foreground="{StaticResource TextSecondary}" HorizontalAlignment="Center" VerticalAlignment="Center" Visibility="Collapsed"/>
                    </Grid>
                </Border>
            </Grid>
        </Border>
        
        <!-- Splitter -->
        <GridSplitter x:Name="RightPanelSplitter" Grid.Column="1" Width="5" HorizontalAlignment="Stretch" Background="{StaticResource DarkBg3}" Cursor="SizeWE"/>
        
        <!-- Right Panel - Calendar Timeline View -->
        <Border x:Name="RightPanel" Grid.Column="2" Background="{StaticResource DarkBg2}" BorderBrush="{StaticResource StrokeBrush}" BorderThickness="1,0,0,0">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/> <!-- Header with dropdown -->
                    <RowDefinition Height="*"/>    <!-- Calendar timeline -->
                    <RowDefinition Height="Auto"/> <!-- Stats -->
                </Grid.RowDefinitions>
                
                <!-- Calendar Range Dropdown -->
                <Border Grid.Row="0" Background="{StaticResource DarkBg3}" BorderBrush="{StaticResource AccentBrush}" BorderThickness="0,0,0,1" Padding="20,15">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <StackPanel Grid.Column="0">
                            <TextBlock Text="📆 VIEW" FontSize="11" FontWeight="Bold" Foreground="{StaticResource TextSecondary}" Margin="0,0,0,10"/>
                            <ComboBox x:Name="CmbCalendarRange" 
                                      Height="42"
                                      FontSize="14"
                                      FontWeight="Medium"
                                      Background="{StaticResource DarkBg2}"
                                      Foreground="{StaticResource TextPrimary}"
                                      BorderBrush="{StaticResource AccentBrush}"
                                      BorderThickness="2"
                                      Padding="14,10"
                                      SelectionChanged="OnCalendarRangeChanged">
                                <ComboBoxItem Content="📅 Today" Tag="today"/>
                                <ComboBoxItem Content="📆 Next 3 Days" Tag="3days"/>
                                <ComboBoxItem Content="📊 This Week" Tag="7days" IsSelected="True"/>
                                <ComboBoxItem Content="🗓️ This Month" Tag="month"/>
                                <ComboBoxItem Content="📈 This Year" Tag="year"/>
                            </ComboBox>
                        </StackPanel>
                        <!-- Switch to Task Editor Button -->
                        <Button x:Name="BtnSwitchToEditor" Grid.Column="1" 
                                Content="✏️" 
                                Width="42" Height="42"
                                FontSize="18"
                                Background="{StaticResource DarkBg2}"
                                Foreground="{StaticResource AccentBrush}"
                                BorderBrush="{StaticResource AccentBrush}"
                                BorderThickness="2"
                                Margin="10,23,0,0"
                                ToolTip="Task Editor"
                                Click="OnSwitchPanelMode"
                                Style="{StaticResource IconButtonStyle}"/>
                    </Grid>
                </Border>
                
                <!-- Task Editor Panel (Hidden by default) -->
                <Border x:Name="TaskEditorPanel" Grid.Row="1" Background="{StaticResource DarkBg1}" Visibility="Collapsed">
                    <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="20">
                        <StackPanel>
                            <!-- Header -->
                            <Grid Margin="0,0,0,20">
                                <TextBlock Text="✏️ Edit Task" FontSize="18" FontWeight="Bold" Foreground="{StaticResource TextPrimary}"/>
                                <Button Content="✕" 
                                        HorizontalAlignment="Right"
                                        Width="32" Height="32"
                                        FontSize="16"
                                        Background="{StaticResource DarkBg3}"
                                        Foreground="{StaticResource TextSecondary}"
                                        BorderBrush="{StaticResource DarkBg4}"
                                        Click="OnCloseTaskEditor"
                                        Style="{StaticResource IconButtonStyle}"/>
                            </Grid>
                            
                            <!-- Task Title -->
                            <TextBlock x:Name="TxtEditorTaskTitle" Text="No task selected" 
                                       FontSize="15" 
                                       FontWeight="SemiBold" 
                                       Foreground="{StaticResource AccentBrush}" 
                                       TextWrapping="Wrap"
                                       Margin="0,0,0,20"/>
                            
                            <!-- Due Date Section -->
                            <Border Background="{StaticResource DarkBg2}" 
                                    BorderBrush="{StaticResource DarkBg4}" 
                                    BorderThickness="1" 
                                    CornerRadius="6" 
                                    Padding="15" 
                                    Margin="0,0,0,15">
                                <StackPanel>
                                    <TextBlock Text="📅 DUE DATE" FontSize="11" FontWeight="Bold" Foreground="{StaticResource TextSecondary}" Margin="0,0,0,10"/>
                                    <Calendar x:Name="EditorCalendar" 
                                              Background="{StaticResource DarkBg3}"
                                              BorderBrush="{StaticResource AccentBrush}"
                                              BorderThickness="1"
                                              SelectedDatesChanged="OnEditorDateChanged"/>
                                    <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                                        <Button Content="Today" Click="OnSetTodayDate" Style="{StaticResource IconButtonStyle}" 
                                                Background="{StaticResource DarkBg3}" Foreground="{StaticResource InfoBrush}" 
                                                Padding="10,6" Margin="0,0,8,0" FontSize="12"/>
                                        <Button Content="Tomorrow" Click="OnSetTomorrowDate" Style="{StaticResource IconButtonStyle}" 
                                                Background="{StaticResource DarkBg3}" Foreground="{StaticResource InfoBrush}" 
                                                Padding="10,6" Margin="0,0,8,0" FontSize="12"/>
                                        <Button Content="Next Week" Click="OnSetNextWeekDate" Style="{StaticResource IconButtonStyle}" 
                                                Background="{StaticResource DarkBg3}" Foreground="{StaticResource InfoBrush}" 
                                                Padding="10,6" FontSize="12"/>
                                    </StackPanel>
                                    <Button Content="🗑️ Clear Date" Click="OnClearDate" 
                                            Style="{StaticResource IconButtonStyle}" 
                                            Background="{StaticResource DarkBg3}" 
                                            Foreground="{StaticResource ErrorBrush}" 
                                            Margin="0,8,0,0" 
                                            HorizontalAlignment="Stretch"
                                            Padding="10,8"
                                            FontSize="13"/>
                                </StackPanel>
                            </Border>
                            
                            <!-- Priority Section -->
                            <Border Background="{StaticResource DarkBg2}" 
                                    BorderBrush="{StaticResource DarkBg4}" 
                                    BorderThickness="1" 
                                    CornerRadius="6" 
                                    Padding="15" 
                                    Margin="0,0,0,15">
                                <StackPanel>
                                    <TextBlock Text="🎯 PRIORITY" FontSize="11" FontWeight="Bold" Foreground="{StaticResource TextSecondary}" Margin="0,0,0,10"/>
                                    <StackPanel Orientation="Horizontal">
                                        <RadioButton x:Name="RbPriorityHigh" Content="🔴 High" GroupName="Priority" 
                                                     Foreground="{StaticResource TextPrimary}" FontSize="13" Margin="0,0,15,0" 
                                                     Checked="OnPriorityChanged"/>
                                        <RadioButton x:Name="RbPriorityMedium" Content="🟡 Medium" GroupName="Priority" 
                                                     Foreground="{StaticResource TextPrimary}" FontSize="13" Margin="0,0,15,0" 
                                                     Checked="OnPriorityChanged"/>
                                        <RadioButton x:Name="RbPriorityLow" Content="🟢 Low" GroupName="Priority" 
                                                     Foreground="{StaticResource TextPrimary}" FontSize="13" 
                                                     Checked="OnPriorityChanged"/>
                                    </StackPanel>
                                </StackPanel>
                            </Border>
                            
                            <!-- Tags Section -->
                            <Border Background="{StaticResource DarkBg2}" 
                                    BorderBrush="{StaticResource DarkBg4}" 
                                    BorderThickness="1" 
                                    CornerRadius="6" 
                                    Padding="15" 
                                    Margin="0,0,0,15">
                                <StackPanel>
                                    <TextBlock Text="🏷️ TAGS" FontSize="11" FontWeight="Bold" Foreground="{StaticResource TextSecondary}" Margin="0,0,0,10"/>
                                    <WrapPanel x:Name="EditorTagsPanel" Margin="0,0,0,10"/>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBox x:Name="TxtNewTag" 
                                                 Grid.Column="0"
                                                 Background="{StaticResource DarkBg3}"
                                                 Foreground="{StaticResource TextPrimary}"
                                                 BorderBrush="{StaticResource DarkBg4}"
                                                 Padding="10,8"
                                                 FontSize="13"
                                                 Margin="0,0,8,0"
                                                 KeyDown="OnNewTagKeyDown"/>
                                        <Button Grid.Column="1" 
                                                Content="➕" 
                                                Width="36" Height="36"
                                                FontSize="16"
                                                Click="OnAddTag"
                                                Style="{StaticResource IconButtonStyle}"
                                                Background="{StaticResource AccentBrush}"
                                                Foreground="White"/>
                                    </Grid>
                                </StackPanel>
                            </Border>
                            
                            <!-- Delete Task Section -->
                            <Button Content="🗑️ Delete Task" 
                                    Click="OnDeleteTaskFromEditor" 
                                    Style="{StaticResource IconButtonStyle}" 
                                    Background="{StaticResource ErrorBrush}" 
                                    Foreground="White" 
                                    HorizontalAlignment="Stretch"
                                    Padding="12,10"
                                    FontSize="14"
                                    FontWeight="SemiBold"/>
                        </StackPanel>
                    </ScrollViewer>
                </Border>
                
                <!-- Visual Calendar Timeline -->
                <ScrollViewer x:Name="CalendarTimelineScroller" Grid.Row="1" VerticalScrollBarVisibility="Auto" Padding="0">
                    <StackPanel x:Name="CalendarTimelinePanel" Margin="0"/>
                </ScrollViewer>
                
                <!-- Quick Stats -->
                <Border Grid.Row="2" Background="{StaticResource DarkBg3}" BorderBrush="{StaticResource AccentBrush}" BorderThickness="0,1,0,0" Padding="20,15">
                    <StackPanel>
                        <TextBlock Text="📊 QUICK STATS" FontSize="11" FontWeight="Bold" Foreground="{StaticResource TextSecondary}" Margin="0,0,0,12"/>
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Grid.Row="0" Grid.Column="0" Text="Active Tasks" FontSize="13" Foreground="{StaticResource TextPrimary}" FontWeight="Medium"/>
                            <TextBlock x:Name="TxtStatsActive" Grid.Row="0" Grid.Column="1" Text="0" FontSize="20" FontWeight="Bold" Foreground="{StaticResource InfoBrush}"/>
                            <TextBlock Grid.Row="1" Grid.Column="0" Text="Completed Today" FontSize="13" Foreground="{StaticResource TextPrimary}" FontWeight="Medium" Margin="0,10,0,0"/>
                            <TextBlock x:Name="TxtStatsCompleted" Grid.Row="1" Grid.Column="1" Text="0" FontSize="20" FontWeight="Bold" Foreground="{StaticResource SuccessBrush}" Margin="0,10,0,0"/>
                            <TextBlock Grid.Row="2" Grid.Column="0" Text="Completion Rate" FontSize="13" Foreground="{StaticResource TextPrimary}" FontWeight="Medium" Margin="0,10,0,0"/>
                            <TextBlock x:Name="TxtStatsRate" Grid.Row="2" Grid.Column="1" Text="0%" FontSize="20" FontWeight="Bold" Foreground="{StaticResource WarningBrush}" Margin="0,10,0,0"/>
                        </Grid>
                    </StackPanel>
                </Border>
            </Grid>
        </Border>
    </Grid>
</Window>